/**
 * DetailPic Gemstone Colors Database
 * 
 * This file contains color information for various gemstones and metals
 * to automatically set color schemes based on product details.
 * Organized by color categories based on gemstone7.com
 */

const gemstoneColors = {
  "gemstones": {
    "ruby": {
      "name": "Ruby",
      "primaryColor": "#9B111E",
      "complementaryColor": "#F9D5EB",
      "headerBg": "#E0115F",
      "rowBg": "#F9D5EB",
      "altRowBg": "#FFFFFF",
      "textColor": "#000000",
      "description": "Deep red gemstone symbolizing passion and vitality"
    },
    "amethyst": {
      "name": "Amethyst",
      "primaryColor": "#9966CC",
      "complementaryColor": "#E6E6FA",
      "headerBg": "#9966CC",
      "rowBg": "#E6E6FA",
      "altRowBg": "#FFFFFF",
      "textColor": "#000000",
      "description": "Purple variety of quartz symbolizing peace and protection"
    },
    "emerald": {
      "name": "Emerald",
      "primaryColor": "#009473",
      "complementaryColor": "#E0F5E6",
      "headerBg": "#009473",
      "rowBg": "#E0F5E6",
      "altRowBg": "#FFFFFF",
      "textColor": "#000000",
      "description": "Vibrant green gemstone symbolizing growth and renewal"
    },
    "sapphire": {
      "name": "Sapphire",
      "primaryColor": "#0F52BA",
      "complementaryColor": "#D0E1F9",
      "headerBg": "#0F52BA",
      "rowBg": "#D0E1F9",
      "altRowBg": "#FFFFFF",
      "textColor": "#000000",
      "description": "Deep blue gemstone symbolizing wisdom and royalty"
    },
    "turquoise": {
      "name": "Turquoise",
      "primaryColor": "#00836E",
      "complementaryColor": "#E0F5F5",
      "headerBg": "#00836E",
      "rowBg": "#E0F5F5",
      "altRowBg": "#FFFFFF",
      "textColor": "#000000",
      "description": "Blue-green gemstone symbolizing healing and protection"
    },
    "garnet": {
      "name": "Garnet",
      "primaryColor": "#830E0D",
      "complementaryColor": "#F5E6E6",
      "headerBg": "#830E0D",
      "rowBg": "#F5E6E6",
      "altRowBg": "#FFFFFF",
      "textColor": "#000000",
      "description": "Deep red gemstone symbolizing strength and protection"
    },
    "citrine": {
      "name": "Citrine",
      "primaryColor": "#E4D00A",
      "complementaryColor": "#FFF8E0",
      "headerBg": "#E4D00A",
      "rowBg": "#FFF8E0",
      "altRowBg": "#FFFFFF",
      "textColor": "#000000",
      "description": "Yellow variety of quartz symbolizing abundance and joy"
    },
    "topaz": {
      "name": "Topaz",
      "primaryColor": "#FFC87C",
      "complementaryColor": "#FFF1E6",
      "headerBg": "#FFC87C",
      "rowBg": "#FFF1E6",
      "altRowBg": "#FFFFFF",
      "textColor": "#000000",
      "description": "Golden-yellow gemstone symbolizing strength and intellect"
    },
    "opal": {
      "name": "Opal",
      "primaryColor": "#A8C3BC",
      "complementaryColor": "#F0F5F3",
      "headerBg": "#A8C3BC",
      "rowBg": "#F0F5F3",
      "altRowBg": "#FFFFFF",
      "textColor": "#000000",
      "description": "Iridescent gemstone symbolizing hope and purity"
    },
    "pearl": {
      "name": "Pearl",
      "primaryColor": "#F0EAD6",
      "complementaryColor": "#FFFAF0",
      "headerBg": "#F0EAD6",
      "rowBg": "#FFFAF0",
      "altRowBg": "#FFFFFF",
      "textColor": "#000000",
      "description": "Organic gemstone symbolizing purity and innocence"
    },
    "diamond": {
      "name": "Diamond",
      "primaryColor": "#B9F2FF",
      "complementaryColor": "#F0F8FF",
      "headerBg": "#B9F2FF",
      "rowBg": "#F0F8FF",
      "altRowBg": "#FFFFFF",
      "textColor": "#000000",
      "description": "Brilliant clear gemstone symbolizing eternity and strength"
    },
    "jade": {
      "name": "Jade",
      "primaryColor": "#00A86B",
      "complementaryColor": "#E0F5EB",
      "headerBg": "#00A86B",
      "rowBg": "#E0F5EB",
      "altRowBg": "#FFFFFF",
      "textColor": "#000000",
      "description": "Green stone symbolizing harmony and balance"
    },
    "aquamarine": {
      "name": "Aquamarine",
      "primaryColor": "#7FFFD4",
      "complementaryColor": "#E0FFFA",
      "headerBg": "#7FFFD4",
      "rowBg": "#E0FFFA",
      "altRowBg": "#FFFFFF",
      "textColor": "#000000",
      "description": "Pale blue-green gemstone symbolizing courage and clarity"
    },
    "morganite": {
      "name": "Morganite",
      "primaryColor": "#FFACC7",
      "complementaryColor": "#FFF0F5",
      "headerBg": "#FFACC7",
      "rowBg": "#FFF0F5",
      "altRowBg": "#FFFFFF",
      "textColor": "#000000",
      "description": "Pink beryl gemstone symbolizing compassion and love"
    },
    "tanzanite": {
      "name": "Tanzanite",
      "primaryColor": "#6A5ACD",
      "complementaryColor": "#E6E6FA",
      "headerBg": "#6A5ACD",
      "rowBg": "#E6E6FA",
      "altRowBg": "#FFFFFF",
      "textColor": "#000000",
      "description": "Blue-purple gemstone symbolizing transformation"
    },
    "peridot": {
      "name": "Peridot",
      "primaryColor": "#AAFF00",
      "complementaryColor": "#F5FFEB",
      "headerBg": "#AAFF00",
      "rowBg": "#F5FFEB",
      "altRowBg": "#FFFFFF",
      "textColor": "#000000",
      "description": "Olive-green gemstone symbolizing strength and good fortune"
    },
    "moonstone": {
      "name": "Moonstone",
      "primaryColor": "#E6E6FA",
      "complementaryColor": "#F8F8FF",
      "headerBg": "#E6E6FA",
      "rowBg": "#F8F8FF",
      "altRowBg": "#FFFFFF",
      "textColor": "#000000",
      "description": "Pearly gemstone symbolizing intuition and new beginnings"
    },
    "labradorite": {
      "name": "Labradorite",
      "primaryColor": "#52667a",
      "complementaryColor": "#e6e8e9",
      "headerBg": "#52667a",
      "rowBg": "#e6e8e9",
      "altRowBg": "#FFFFFF",
      "textColor": "#000000",
      "description": "Feldspar gemstone known for its labradorescence color play effect"
    },
    "lapis lazuli": {
      "name": "Lapis Lazuli",
      "primaryColor": "#26619c",
      "complementaryColor": "#e0eaf5",
      "headerBg": "#26619c",
      "rowBg": "#e0eaf5",
      "altRowBg": "#FFFFFF",
      "textColor": "#000000",
      "description": "Deep blue metamorphic rock with golden pyrite inclusions"
    },
    "malachite": {
      "name": "Malachite",
      "primaryColor": "#0bda51",
      "complementaryColor": "#e0f5e8",
      "headerBg": "#0bda51",
      "rowBg": "#e0f5e8",
      "altRowBg": "#FFFFFF",
      "textColor": "#000000",
      "description": "Banded green copper carbonate mineral with distinctive patterns"
    },
    "alexandrite": {
      "name": "Alexandrite",
      "primaryColor": "#008000",
      "complementaryColor": "#f0f5f0",
      "headerBg": "#008000",
      "rowBg": "#f0f5f0",
      "altRowBg": "#FFFFFF",
      "textColor": "#000000",
      "description": "Color-changing gemstone appearing green in daylight and red in incandescent light"
    },
    "rhodochrosite": {
      "name": "Rhodochrosite",
      "primaryColor": "#e03c31",
      "complementaryColor": "#f9e6e5",
      "headerBg": "#e03c31",
      "rowBg": "#f9e6e5",
      "altRowBg": "#FFFFFF",
      "textColor": "#000000",
      "description": "Pink to rose-red manganese carbonate mineral with banded patterns"
    },
    "larimar": {
      "name": "Larimar",
      "primaryColor": "#7eb6ff",
      "complementaryColor": "#eef5ff",
      "headerBg": "#7eb6ff",
      "rowBg": "#eef5ff",
      "altRowBg": "#FFFFFF",
      "textColor": "#000000",
      "description": "Rare blue variety of pectolite found only in the Dominican Republic"
    },
    "kunzite": {
      "name": "Kunzite",
      "primaryColor": "#e5c4d4",
      "complementaryColor": "#f9f5f7",
      "headerBg": "#e5c4d4",
      "rowBg": "#f9f5f7",
      "altRowBg": "#FFFFFF",
      "textColor": "#000000",
      "description": "Pale pink to lilac spodumene gemstone with strong pleochroism"
    },
    "iolite": {
      "name": "Iolite",
      "primaryColor": "#3f5fa9",
      "complementaryColor": "#e6eaf5",
      "headerBg": "#3f5fa9",
      "rowBg": "#e6eaf5",
      "altRowBg": "#FFFFFF",
      "textColor": "#000000",
      "description": "Violet-blue cordierite gemstone with strong pleochroism"
    },
    "sunstone": {
      "name": "Sunstone",
      "primaryColor": "#e67e30",
      "complementaryColor": "#f9eee5",
      "headerBg": "#e67e30",
      "rowBg": "#f9eee5",
      "altRowBg": "#FFFFFF",
      "textColor": "#000000",
      "description": "Feldspar with copper inclusions creating a metallic aventurescence effect"
    }
  },
  "metals": {
    "gold": {
      "name": "Gold",
      "primaryColor": "#D4AF37",
      "complementaryColor": "#FFF8E0",
      "headerBg": "#D4AF37",
      "rowBg": "#FFF8E0",
      "altRowBg": "#FFFFFF",
      "textColor": "#000000",
      "description": "Precious yellow metal symbolizing wealth and prosperity"
    },
    "silver": {
      "name": "Silver",
      "primaryColor": "#C0C0C0",
      "complementaryColor": "#F5F5F5",
      "headerBg": "#C0C0C0",
      "rowBg": "#F5F5F5",
      "altRowBg": "#FFFFFF",
      "textColor": "#000000",
      "description": "Precious white metal symbolizing purity and clarity"
    },
    "platinum": {
      "name": "Platinum",
      "primaryColor": "#E5E4E2",
      "complementaryColor": "#F8F8F8",
      "headerBg": "#E5E4E2",
      "rowBg": "#F8F8F8",
      "altRowBg": "#FFFFFF",
      "textColor": "#000000",
      "description": "Rare white metal symbolizing prestige and endurance"
    },
    "rose gold": {
      "name": "Rose Gold",
      "primaryColor": "#B76E79",
      "complementaryColor": "#F9E6E9",
      "headerBg": "#B76E79",
      "rowBg": "#F9E6E9",
      "altRowBg": "#FFFFFF",
      "textColor": "#000000",
      "description": "Pink-hued gold alloy symbolizing romance and elegance"
    }
  },
  "colors": {
    "red": ["ruby", "garnet", "red beryl", "red spinel", "red tourmaline", "rhodochrosite", "cuprite", "cinnabar", "realgar", "rubellite", "red jasper", "carnelian", "fire opal"],
    "pink": ["morganite", "pink sapphire", "pink tourmaline", "pink topaz", "pink spinel", "kunzite", "rose quartz", "rhodochrosite", "rhodonite", "pink opal", "pink coral", "thulite"],
    "orange": ["spessartite", "orange sapphire", "fire opal", "orange tourmaline", "sunstone", "padparadscha", "carnelian", "orange calcite", "orange zircon", "hessonite", "spessartine", "mexican opal"],
    "yellow": ["citrine", "yellow sapphire", "yellow beryl", "yellow tourmaline", "yellow topaz", "heliodor", "amber", "yellow jade", "yellow apatite", "yellow calcite", "golden beryl", "sphene", "sulfur"],
    "green": ["emerald", "peridot", "green tourmaline", "green beryl", "jade", "chrysoprase", "malachite", "alexandrite", "aventurine", "green apatite", "chrome diopside", "tsavorite", "green fluorite", "nephrite", "hiddenite", "prasiolite", "prehnite", "variscite", "gaspeite", "chrysoberyl", "diopside", "dioptase", "epidote", "fuchsite", "maw sit sit", "serpentine", "seraphinite", "verdelite", "zoisite"],
    "aqua": ["aquamarine", "blue-green tourmaline", "hemimorphite", "chrysocolla", "larimar", "amazonite", "paraiba tourmaline", "apatite", "blue-green fluorite", "turquoise", "blue chalcedony", "blue apatite"],
    "blue": ["sapphire", "blue topaz", "blue tourmaline", "blue beryl", "blue spinel", "lapis lazuli", "larimar", "iolite", "kyanite", "blue fluorite", "blue chalcedony", "azurite", "benitoite", "blue apatite", "blue zircon", "hauyne", "indicolite", "sodalite", "shattuckite", "dumortierite", "celestite", "apatite", "blue amber", "blue quartz", "cavansite", "vivianite", "chalcanthite", "lazulite"],
    "purple": ["amethyst", "purple sapphire", "purple spinel", "purple tourmaline", "tanzanite", "iolite", "kunzite", "charoite", "sugilite", "lepidolite", "fluorite", "purple jade", "purpurite", "stichtite"],
    "brown": ["smoky quartz", "brown tourmaline", "brown zircon", "amber", "andalusite", "axinite", "bronzite", "brown jasper", "dravite", "hypersthene", "pietersite", "tiger's eye", "zircon"],
    "black": ["black diamond", "black spinel", "black tourmaline", "onyx", "obsidian", "jet", "black jade", "black opal", "black star sapphire", "hematite", "magnetite", "schorl", "shungite", "tektite", "morion", "nuummite"],
    "white": ["diamond", "white sapphire", "white topaz", "moonstone", "goshenite", "white beryl", "pearl", "white jade", "white opal", "white agate", "white coral", "white howlite", "white calcite", "selenite", "magnesite", "white quartz"],
    "clear": ["diamond", "rock crystal", "goshenite", "danburite", "phenacite", "apophyllite", "quartz", "zircon", "topaz", "moissanite", "scolecite", "selenite"],
    "gray": ["labradorite", "hematite", "gray spinel", "gray diamond", "gray moonstone", "gray agate", "gray chalcedony", "pyrite", "marcasite", "platinum"],
    "multicolor": ["labradorite", "opal", "ammolite", "alexandrite", "watermelon tourmaline", "fluorite", "tourmaline", "mystic topaz", "mystic quartz", "ametrine", "rainbow moonstone", "rainbow fluorite", "rainbow obsidian", "rainbow pyrite", "rainbow hematite"],
    "rainbow": ["rainbow moonstone", "rainbow fluorite", "rainbow obsidian", "rainbow pyrite", "rainbow hematite", "mystic topaz", "mystic quartz", "fire agate", "fire opal", "iris agate", "labradorite"],
    "color-changing": ["alexandrite", "color-change garnet", "color-change sapphire", "color-change fluorite", "color-change diaspore", "color-change spinel"]
  },
  "gemstoneVarieties": {
    "beryl": {
      "yellow": "heliodor",
      "green": "emerald",
      "blue": "aquamarine",
      "pink": "morganite",
      "red": "bixbite",
      "colorless": "goshenite"
    },
    "corundum": {
      "red": "ruby",
      "blue": "sapphire",
      "yellow": "yellow sapphire",
      "pink": "pink sapphire",
      "purple": "purple sapphire",
      "orange": "padparadscha"
    },
    "quartz": {
      "purple": "amethyst",
      "yellow": "citrine",
      "pink": "rose quartz",
      "brown": "smoky quartz",
      "colorless": "rock crystal"
    },
    "tourmaline": {
      "green": "verdelite",
      "blue": "indicolite",
      "red": "rubellite",
      "pink": "pink tourmaline",
      "yellow": "yellow tourmaline",
      "black": "schorl"
    },
    "topaz": {
      "blue": "blue topaz",
      "yellow": "imperial topaz",
      "pink": "pink topaz",
      "colorless": "white topaz"
    },
    "feldspar": {
      "blue-gray": "labradorite",
      "white": "moonstone",
      "green": "amazonite",
      "orange": "sunstone"
    },
    "opal": {
      "white": "white opal",
      "black": "black opal",
      "fire": "fire opal",
      "boulder": "boulder opal"
    },
    "garnet": {
      "red": "pyrope",
      "orange": "spessartite",
      "green": "tsavorite",
      "purple": "rhodolite"
    },
    "spinel": {
      "red": "red spinel",
      "blue": "blue spinel",
      "pink": "pink spinel",
      "purple": "purple spinel",
      "black": "black spinel"
    }
  },
  "gemstoneProperties": {
    "tourmaline": {
      "colors": ["green", "pink", "blue", "red", "yellow", "black", "multicolor"],
      "effects": ["pleochroism", "pyroelectricity", "piezoelectricity"],
      "family": "cyclosilicate",
      "hardness": "7-7.5",
      "locations": ["Brazil", "Afghanistan", "USA", "Madagascar", "Mozambique"],
      "transparency": "transparent to opaque"
    },
    "kyanite": {
      "colors": ["blue", "white", "gray", "green"],
      "effects": ["chatoyancy", "directional hardness"],
      "family": "aluminosilicate",
      "hardness": "4.5-7",
      "locations": ["Brazil", "Switzerland", "USA", "India", "Kenya"],
      "transparency": "transparent to translucent"
    },
    "labradorite": {
      "colors": ["gray", "blue", "green", "gold", "purple"],
      "effects": ["labradorescence", "color play"],
      "family": "feldspar",
      "hardness": "6-6.5",
      "locations": ["Madagascar", "Canada", "Finland", "Russia"],
      "transparency": "translucent to opaque"
    },
    "opal": {
      "colors": ["white", "black", "orange", "multicolor"],
      "effects": ["play of color", "opalescence"],
      "family": "mineraloid",
      "hardness": "5.5-6.5",
      "locations": ["Australia", "Ethiopia", "Mexico", "Brazil"],
      "transparency": "transparent to opaque"
    },
    "ruby": {
      "colors": ["red", "pink-red"],
      "effects": ["asterism", "fluorescence"],
      "family": "corundum",
      "hardness": "9",
      "locations": ["Myanmar", "Thailand", "Sri Lanka", "Madagascar"],
      "transparency": "transparent to translucent"
    },
    "sapphire": {
      "colors": ["blue", "yellow", "pink", "purple", "green", "colorless"],
      "effects": ["asterism", "color change"],
      "family": "corundum",
      "hardness": "9",
      "locations": ["Kashmir", "Sri Lanka", "Madagascar", "Australia", "Thailand"],
      "transparency": "transparent to translucent"
    },
    "emerald": {
      "colors": ["green"],
      "effects": ["jardins (inclusions)"],
      "family": "beryl",
      "hardness": "7.5-8",
      "locations": ["Colombia", "Zambia", "Brazil", "Afghanistan"],
      "transparency": "transparent to translucent"
    },
    "diamond": {
      "colors": ["colorless", "yellow", "brown", "blue", "pink", "green", "red", "black"],
      "effects": ["adamantine luster", "dispersion", "fluorescence"],
      "family": "diamond",
      "hardness": "10",
      "locations": ["South Africa", "Russia", "Botswana", "Canada", "Australia"],
      "transparency": "transparent"
    },
    "amethyst": {
      "colors": ["purple", "violet"],
      "effects": ["color zoning"],
      "family": "quartz",
      "hardness": "7",
      "locations": ["Brazil", "Uruguay", "Zambia", "Russia"],
      "transparency": "transparent"
    }
  },
  "default": {
    "name": "Default",
    "primaryColor": "#6A5ACD",
    "complementaryColor": "#F0F8FF",
    "headerBg": "#6A5ACD",
    "rowBg": "#F0F8FF",
    "altRowBg": "#FFFFFF",
    "textColor": "#000000",
    "description": "Default color scheme"
  }
};

/**
 * Detects gemstone or metal from product details and returns appropriate color scheme
 * 
 * @param {Object} productDetails - The scraped product details
 * @returns {Object} - Color scheme based on detected gemstone or metal
 */
export const detectGemstoneColors = (productDetails) => {
  if (!productDetails) return gemstoneColors.default;

  // Convert product details to a single string for easier searching
  const detailsText = Object.entries(productDetails)
    .map(([key, value]) => `${key} ${value}`)
    .join(' ')
    .toLowerCase();

  // Extract color information from product details
  let colorInfo = null;
  const colorFields = [
    'Color', 'Gemstone Color', 'Stone Color', 'Main Stone Color',
    'Primary Color', 'Dominant Color', 'Gem Color', 'Crystal Color'
  ];

  for (const field of colorFields) {
    if (productDetails[field]) {
      colorInfo = productDetails[field].toLowerCase();
      console.log(`Found color information in ${field}: ${colorInfo}`);
      break;
    }
  }

  // Extract gemstone family information
  let gemstoneFamily = null;
  const gemstoneFields = [
    'Gemstone', 'Gem Type', 'Gemstone Type', 'Stone Type', 'Main Stone',
    'Stone', 'Gem', 'Crystal Type', 'Material', 'Mineral'
  ];

  for (const field of gemstoneFields) {
    if (productDetails[field]) {
      gemstoneFamily = productDetails[field].toLowerCase();
      console.log(`Found gemstone family in ${field}: ${gemstoneFamily}`);
      break;
    }
  }

  // Check for special effects or properties
  let specialEffects = [];
  const effectFields = [
    'Effect', 'Optical Effect', 'Special Properties', 'Phenomena',
    'Visual Effect', 'Appearance', 'Luster'
  ];

  for (const field of effectFields) {
    if (productDetails[field]) {
      const effect = productDetails[field].toLowerCase();
      specialEffects.push(effect);
      console.log(`Found special effect in ${field}: ${effect}`);
    }
  }

  // Check for color-changing or multicolor effects
  const hasColorChangingEffect = specialEffects.some(effect =>
    effect.includes('color change') || effect.includes('alexandrite effect') ||
    effect.includes('color shift') || effect.includes('pleochroism')
  );

  const hasMulticolorEffect = specialEffects.some(effect =>
    effect.includes('play of color') || effect.includes('labradorescence') ||
    effect.includes('opalescence') || effect.includes('adularescence') ||
    effect.includes('iridescence') || effect.includes('rainbow')
  );

  // Check for specific color + gemstone combinations first
  if (colorInfo && gemstoneFamily) {
    // Normalize color information to basic color terms
    const normalizedColor = normalizeColor(colorInfo);

    // Check if we have a specific variety for this gemstone family and color
    if (gemstoneColors.gemstoneVarieties[gemstoneFamily] &&
      gemstoneColors.gemstoneVarieties[gemstoneFamily][normalizedColor]) {

      const specificVariety = gemstoneColors.gemstoneVarieties[gemstoneFamily][normalizedColor];
      console.log(`Detected specific variety: ${specificVariety} based on ${gemstoneFamily} + ${normalizedColor}`);

      // Check if we have a color scheme for this specific variety
      if (gemstoneColors.gemstones[specificVariety]) {
        return {
          ...gemstoneColors.gemstones[specificVariety],
          detectedGemstone: specificVariety,
          detectionMethod: 'color+family'
        };
      }
    }

    // If no specific variety found, try to match based on color alone
    if (normalizedColor && gemstoneColors.colors[normalizedColor]) {
      // Get gemstones associated with this color
      const gemstonesForColor = gemstoneColors.colors[normalizedColor];

      // Find the first gemstone in our database that matches this color
      for (const gem of gemstonesForColor) {
        if (gemstoneColors.gemstones[gem]) {
          console.log(`Detected gemstone by color: ${gem} based on color ${normalizedColor}`);
          return {
            ...gemstoneColors.gemstones[gem],
            detectedGemstone: gem,
            detectionMethod: 'color'
          };
        }
      }
    }
  }

  // Check for special categories based on effects
  if (hasColorChangingEffect && gemstoneColors.colors['color-changing']) {
    const colorChangingGems = gemstoneColors.colors['color-changing'];
    for (const gem of colorChangingGems) {
      if (gemstoneColors.gemstones[gem]) {
        console.log(`Detected color-changing gemstone: ${gem}`);
        return {
          ...gemstoneColors.gemstones[gem],
          detectedGemstone: gem,
          detectionMethod: 'special-effect'
        };
      }
    }
  }

  if (hasMulticolorEffect) {
    // Check rainbow first, then multicolor
    const categories = ['rainbow', 'multicolor'];

    for (const category of categories) {
      if (gemstoneColors.colors[category]) {
        const multicolorGems = gemstoneColors.colors[category];
        for (const gem of multicolorGems) {
          if (gemstoneColors.gemstones[gem]) {
            console.log(`Detected ${category} gemstone: ${gem}`);
            return {
              ...gemstoneColors.gemstones[gem],
              detectedGemstone: gem,
              detectionMethod: 'special-effect'
            };
          }
        }
      }
    }
  }

  // Check for gemstones by name as before
  for (const [gemstone, colorData] of Object.entries(gemstoneColors.gemstones)) {
    // Look for gemstone name with word boundaries to avoid partial matches
    const regex = new RegExp(`\\b${gemstone}\\b|\\b${gemstone}s\\b`, 'i');

    // Special case for tourmaline to catch all varieties
    if (gemstone === 'tourmaline' &&
      (detailsText.includes('tourmaline') ||
        detailsText.includes('tourmuline') || // Common misspelling
        detailsText.includes('rubellite') ||
        detailsText.includes('indicolite') ||
        detailsText.includes('verdelite') ||
        detailsText.includes('paraiba') ||
        detailsText.includes('dravite') ||
        detailsText.includes('schorl'))) {
      console.log(`Detected tourmaline gemstone`);
      return {
        ...colorData,
        detectedGemstone: gemstone,
        detectionMethod: 'name'
      };
    }

    if (regex.test(detailsText)) {
      console.log(`Detected gemstone by name: ${gemstone}`);
      return {
        ...colorData,
        detectedGemstone: gemstone,
        detectionMethod: 'name'
      };
    }
  }

  // If no gemstone found, check for metals
  for (const [metal, colorData] of Object.entries(gemstoneColors.metals)) {
    const regex = new RegExp(`\\b${metal}\\b`, 'i');
    if (regex.test(detailsText)) {
      console.log(`Detected metal: ${metal}`);
      return {
        ...colorData,
        detectedMetal: metal,
        detectionMethod: 'name'
      };
    }
  }

  // If we have color information but no gemstone match, try to use the color category directly
  if (colorInfo) {
    const normalizedColor = normalizeColor(colorInfo);
    if (normalizedColor && gemstoneColors.colors[normalizedColor] && gemstoneColors.colors[normalizedColor].length > 0) {
      // Use the first gemstone in that color category
      const representativeGem = gemstoneColors.colors[normalizedColor][0];
      if (gemstoneColors.gemstones[representativeGem]) {
        console.log(`Using representative gemstone ${representativeGem} for color ${normalizedColor}`);
        return {
          ...gemstoneColors.gemstones[representativeGem],
          detectedColor: normalizedColor,
          detectionMethod: 'color-category'
        };
      }
    }
  }

  // Default fallback
  return gemstoneColors.default;
};

/**
 * Normalizes color descriptions to basic color terms
 * 
 * @param {string} colorText - The color description text
 * @returns {string} - Normalized basic color term
 */
const normalizeColor = (colorText) => {
  colorText = colorText.toLowerCase();

  // Map various color descriptions to basic color terms
  if (colorText.includes('red') || colorText.includes('ruby') || colorText.includes('crimson') ||
    colorText.includes('scarlet') || colorText.includes('burgundy') || colorText.includes('maroon') ||
    colorText.includes('blood') || colorText.includes('garnet') || colorText.includes('cinnabar')) {
    return 'red';
  }

  if (colorText.includes('pink') || colorText.includes('rose') || colorText.includes('magenta') ||
    colorText.includes('fuchsia') || colorText.includes('blush') || colorText.includes('salmon') ||
    colorText.includes('rhodochrosite') || colorText.includes('morganite')) {
    return 'pink';
  }

  if (colorText.includes('orange') || colorText.includes('amber') || colorText.includes('coral') ||
    colorText.includes('peach') || colorText.includes('carnelian') || colorText.includes('spessartite') ||
    colorText.includes('hessonite') || colorText.includes('padparadscha')) {
    return 'orange';
  }

  if (colorText.includes('yellow') || colorText.includes('gold') || colorText.includes('lemon') ||
    colorText.includes('canary') || colorText.includes('honey') || colorText.includes('citrine') ||
    colorText.includes('heliodor') || colorText.includes('sulfur') || colorText.includes('topaz')) {
    return 'yellow';
  }

  if (colorText.includes('green') || colorText.includes('emerald') || colorText.includes('mint') ||
    colorText.includes('olive') || colorText.includes('jade') || colorText.includes('peridot') ||
    colorText.includes('chrysoprase') || colorText.includes('malachite') || colorText.includes('aventurine') ||
    colorText.includes('tsavorite') || colorText.includes('chrome')) {
    return 'green';
  }

  // Specific check for aqua/turquoise colors
  if (colorText.includes('aqua') || colorText.includes('turquoise') || colorText.includes('teal') ||
    colorText.includes('cyan') || colorText.includes('sea') || colorText.includes('aquamarine') ||
    colorText.includes('larimar') || colorText.includes('paraiba')) {
    return 'aqua';
  }

  if (colorText.includes('blue') || colorText.includes('azure') || colorText.includes('sapphire') ||
    colorText.includes('navy') || colorText.includes('indigo') || colorText.includes('cobalt') ||
    colorText.includes('lapis') || colorText.includes('iolite') || colorText.includes('kyanite') ||
    colorText.includes('celestite') || colorText.includes('azurite') || colorText.includes('blue tourmaline')) {
    return 'blue';
  }

  if (colorText.includes('purple') || colorText.includes('violet') || colorText.includes('lavender') ||
    colorText.includes('amethyst') || colorText.includes('lilac') || colorText.includes('mauve') ||
    colorText.includes('tanzanite') || colorText.includes('sugilite') || colorText.includes('charoite')) {
    return 'purple';
  }

  if (colorText.includes('brown') || colorText.includes('chocolate') || colorText.includes('coffee') ||
    colorText.includes('tan') || colorText.includes('bronze') || colorText.includes('smoky') ||
    colorText.includes('cognac') || colorText.includes('cinnamon') || colorText.includes('sepia')) {
    return 'brown';
  }

  if (colorText.includes('black') || colorText.includes('onyx') || colorText.includes('jet') ||
    colorText.includes('ebony') || colorText.includes('obsidian') || colorText.includes('morion') ||
    colorText.includes('schorl') || colorText.includes('spinel')) {
    return 'black';
  }

  if (colorText.includes('gray') || colorText.includes('grey') || colorText.includes('silver') ||
    colorText.includes('slate') || colorText.includes('pewter') || colorText.includes('hematite') ||
    colorText.includes('pyrite') || colorText.includes('marcasite')) {
    return 'gray';
  }

  if (colorText.includes('white') || colorText.includes('pearl') || colorText.includes('ivory') ||
    colorText.includes('cream') || colorText.includes('moonstone') || colorText.includes('howlite') ||
    colorText.includes('selenite') || colorText.includes('magnesite')) {
    return 'white';
  }

  if (colorText.includes('clear') || colorText.includes('transparent') || colorText.includes('colorless') ||
    colorText.includes('crystal') || colorText.includes('diamond') || colorText.includes('goshenite') ||
    colorText.includes('rock crystal') || colorText.includes('quartz')) {
    return 'clear';
  }

  // Check for multicolor, rainbow, and color-changing properties
  if (colorText.includes('multicolor') || colorText.includes('multi-color') || colorText.includes('multi color') ||
    colorText.includes('mixed') || colorText.includes('variegated') || colorText.includes('play of color') ||
    colorText.includes('labradorescence') || colorText.includes('opalescence')) {
    return 'multicolor';
  }

  if (colorText.includes('rainbow') || colorText.includes('spectrum') || colorText.includes('iridescent') ||
    colorText.includes('fire') || colorText.includes('mystic') || colorText.includes('iris')) {
    return 'rainbow';
  }

  if (colorText.includes('color change') || colorText.includes('color-change') || colorText.includes('alexandrite') ||
    colorText.includes('changing') || colorText.includes('chameleon')) {
    return 'color-changing';
  }

  // If no match found, return null
  return null;
};

export default gemstoneColors;
